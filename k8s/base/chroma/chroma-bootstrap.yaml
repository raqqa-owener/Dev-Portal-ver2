apiVersion: v1
kind: ConfigMap
metadata:
  name: chroma-bootstrap
  labels:
    app: chroma
data:
  entrypoint.sh: |-
    #!/usr/bin/env sh
    set -euo pipefail

    # 1) 必要パッケージ
    python -m pip install --no-cache-dir --upgrade pip
    python -m pip install --no-cache-dir "chromadb[server]==0.4.24" "uvicorn>=0.30,<1"

    # 2) インポート確認（1行）
    python -c "import chromadb, uvicorn; print('chromadb version:', getattr(chromadb, '__version__', 'unknown'))"

    # 3) サーバ起動
    exec uvicorn chromadb.app:app --host 0.0.0.0 --port 8000 --timeout-keep-alive 30
